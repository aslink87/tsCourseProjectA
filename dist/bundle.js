(()=>{"use strict";class e{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}function t(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}var n;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(n||(n={}));class r{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class s extends class{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new s),this.instance}addProject(e,t,s){const i=new r(Math.random().toString(),e,t,s,n.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const i=s.getInstance();function l(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}class o extends e{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}gatherUserInput(){const e=this.titleInputElement.value,n=this.descriptionInputElement.value,r=this.peopleInputElement.value,s={value:n,required:!0,minLength:5},i={value:+r,required:!0,min:1,max:5};return t({value:e,required:!0})&&t(s)&&t(i)?[e,n,+r]:void alert("Invalid input")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;console.log(e,n,r),i.addProject(e,n,r),this.clearInputs()}}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([l],o.prototype,"submitHandler",null);class a extends e{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons`}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("dragend")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent=this.project.description}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([l],a.prototype,"dragStartHandler",null);var c=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class d extends e{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){e.preventDefault(),e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){e.preventDefault();const t=e.dataTransfer.getData("text/plain");i.moveProject(t,"active"===this.type?n.Active:n.Finished),this.dragLeaveHandler(e)}dragLeaveHandler(e){e.preventDefault(),this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),i.addListener((e=>{const t=e.filter((e=>"active"===this.type?e.status===n.Active:e.status===n.Finished));this.assignedProjects=t,this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new a(this.element.querySelector("ul").id,e)}}c([l],d.prototype,"dragOverHandler",null),c([l],d.prototype,"dropHandler",null),c([l],d.prototype,"dragLeaveHandler",null),new o,new d("active"),new d("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FBS1EsUUFBUTJELGNBQWMsTUFDbkNxQyxVQUFVTyxPQUFPLGFBRzFCekMsWUFDRXRFLEtBQUtRLFFBQVErRCxpQkFBaUIsV0FBWXZFLEtBQUtzRyxpQkFDL0N0RyxLQUFLUSxRQUFRK0QsaUJBQWlCLFlBQWF2RSxLQUFLOEcsa0JBQ2hEOUcsS0FBS1EsUUFBUStELGlCQUFpQixPQUFRdkUsS0FBSzBHLGFBRTNDbkQsRUFBYXJCLGFBQWFJLElBQ3hCLE1BQU0wRSxFQUFtQjFFLEVBQVMyRSxRQUFPNUQsR0FDckIsV0FBZHJELEtBQUtvRyxLQUNBL0MsRUFBSXRCLFNBQVdMLEVBQWNvQixPQUUvQk8sRUFBSXRCLFNBQVdMLEVBQWNtRixXQUV0QzdHLEtBQUtxRyxpQkFBbUJXLEVBQ3hCaEgsS0FBS2tILG9CQUlUekMsZ0JBQ0UsTUFBTTBDLEVBQVMsR0FBR25ILEtBQUtvRyxxQkFDdkJwRyxLQUFLUSxRQUFRMkQsY0FBYyxNQUFPekQsR0FBS3lHLEVBQ3ZDbkgsS0FBS1EsUUFBUTJELGNBQWMsTUFBTytCLFlBQWNsRyxLQUFLb0csS0FBS2dCLGNBQWdCLFlBR3BFRixpQkFDU2hILFNBQVNDLGVBQWUsR0FBR0gsS0FBS29HLHNCQUl4Q2lCLFVBQVksR0FDbkIsSUFBSyxNQUFNQyxLQUFXdEgsS0FBS3FHLGlCQUN6QixJQUFJWCxFQUFZMUYsS0FBS1EsUUFBUTJELGNBQWMsTUFBT3pELEdBQUk0RyxJQXZEMUQsR0FEQzdELEcsb0NBV0QsR0FEQ0EsRyxnQ0FVRCxHQURDQSxHLHFDQ2xDSCxJQUFJUSxFQUNKLElBQUlrQyxFQUFZLFVBQ2hCLElBQUlBLEVBQVksYSIsInNvdXJjZXMiOlsid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy91dGlsL3ZhbGlkYXRpb24udHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL21vZGVscy9wcm9qZWN0LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9zdGF0ZS9wcm9qZWN0LXN0YXRlLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9kZWNvcmF0b3JzL2F1dG9iaW5kLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtaW5wdXQudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pdGVtLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtbGlzdC50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvYXBwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvbXBvbmVudCBCYXNlIENsYXNzXG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDb21wb25lbnQ8VCBleHRlbmRzIEhUTUxFbGVtZW50LCBVIGV4dGVuZHMgSFRNTEVsZW1lbnQ+IHtcbiAgdGVtcGxhdGVFbGVtZW50OiBIVE1MVGVtcGxhdGVFbGVtZW50O1xuICBob3N0RWxlbWVudDogVDtcbiAgZWxlbWVudDogVTtcblxuICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZUlkOiBzdHJpbmcsIGhvc3RFbGVtZW50SWQ6IHN0cmluZywgaW5zZXJ0QXRTdGFydDogYm9vbGVhbiwgbmV3RWxlbWVudElkPzogc3RyaW5nKSB7XG4gICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0ZW1wbGF0ZUlkKSEgYXMgSFRNTFRlbXBsYXRlRWxlbWVudDtcbiAgICB0aGlzLmhvc3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaG9zdEVsZW1lbnRJZCkhIGFzIFQ7XG5cbiAgICBjb25zdCBpbXBvcnRlZE5vZGUgPSBkb2N1bWVudC5pbXBvcnROb2RlKHRoaXMudGVtcGxhdGVFbGVtZW50LmNvbnRlbnQsIHRydWUpO1xuICAgIHRoaXMuZWxlbWVudCA9IGltcG9ydGVkTm9kZS5maXJzdEVsZW1lbnRDaGlsZCBhcyBVO1xuICAgIC8vIGFkZCBlbGVtZW50IGlkIHRvIGF0dGFjaCBjc3MgZm9ybWF0dGluZ1xuICAgIGlmIChuZXdFbGVtZW50SWQpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5pZCA9IG5ld0VsZW1lbnRJZDtcbiAgICB9O1xuXG4gICAgdGhpcy5hdHRhY2goaW5zZXJ0QXRTdGFydCk7XG4gIH07XG5cbiAgcHJpdmF0ZSBhdHRhY2goaW5zZXJ0QXRCZWdpbm5pbmc6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmhvc3RFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudChpbnNlcnRBdEJlZ2lubmluZyA/ICdhZnRlcmJlZ2luJyA6ICdiZWZvcmVlbmQnLCB0aGlzLmVsZW1lbnQpO1xuICB9O1xuXG4gIGFic3RyYWN0IGNvbmZpZ3VyZSgpOiB2b2lkO1xuICBhYnN0cmFjdCByZW5kZXJDb250ZW50KCk6IHZvaWQ7XG59XG4iLCIvLyBWYWxpZGF0aW9uXG5cbi8vIGludGVyZmFjZSB0byBkZWZpbmUgc3RydWN0dXJlIG9mIGFuIG9iamVjdCwgb25seSByZXF1aXJlICd2YWx1ZSdcbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGFibGUge1xuICB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyO1xuICByZXF1aXJlZD86IGJvb2xlYW47XG4gIG1pbkxlbmd0aD86IG51bWJlcjtcbiAgbWF4TGVuZ3RoPzogbnVtYmVyO1xuICAvLyBtaW4gJiBtYXggdG8gY2hlY2sgdmFsdWUgb2YgbnVtYmVyLCBub3Qgc3RyaW5nXG4gIG1pbj86IG51bWJlcjtcbiAgbWF4PzogbnVtYmVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGUodmFsaWRhdGFibGVJbnB1dDogVmFsaWRhdGFibGUpIHtcbiAgbGV0IGlzVmFsaWQgPSB0cnVlO1xuICBpZiAodmFsaWRhdGFibGVJbnB1dC5yZXF1aXJlZCkge1xuICAgIC8vIHJlcXVpcmVkIGlucHV0IGlzIG5vdCBlbXB0eVxuICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwO1xuICB9XG4gIC8vIGNoZWNrIG1pbkxlbmd0aCBhbmQgaW5jbHVkZSB0eXBndWFyZCB0byBleGNsdWRlIG51bWJlcnNcbiAgLy8gJyE9IG51bGwnIGFsbG93cyB1cyB0byBydW4gdGhpcyBzdGVwIGFnYWluc3QgMCB2YWx1ZXNcbiAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWluTGVuZ3RoICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPj0gdmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGg7XG4gIH1cbiAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWF4TGVuZ3RoICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPD0gdmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGg7XG4gIH1cbiAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWluICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbjtcbiAgfVxuICBpZiAodmFsaWRhdGFibGVJbnB1dC5tYXggIT0gbnVsbCAmJiB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlIDw9IHZhbGlkYXRhYmxlSW5wdXQubWF4O1xuICB9XG4gIHJldHVybiBpc1ZhbGlkO1xufVxuXG4iLCIvLyBQcm9qZWN0IFR5cGVcbi8vIGxldCdzIGRlZmluZSB0aGUgdHlwZSBmb3IgYSBwcm9qZWN0IHNvIHdlIGRvbid0IGhhdmUgdG8gYXNzaWduIGFueVtdIHR5cGVcbi8vIHdlIHdpbGwgdXNlIGEgY2xhc3MsIG5vdCBhbiBpbnRlcmZhY2UsIHNvIHRoYXQgaXQgY2FuIGJlIGVuc3RhbnRpYXRlZFxuXG4vLyB1c2UgYW4gZW51bSB0byBpZG5ldGlmeSBhIHByb2plY3Qgc3RhdHVzIHNvIHRoYXQgcHJvamVjdHMgY2FuIGJlIHNlcGFyYXRlZCBvbiB0aGUgRE9NIGFjY29yZGluZyB0byBzdGF0dXNcbmV4cG9ydCBlbnVtIFByb2plY3RTdGF0dXMgeyBBY3RpdmUsIEZpbmlzaGVkIH1cblxuZXhwb3J0IGNsYXNzIFByb2plY3Qge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgaWQ6IHN0cmluZyxcbiAgICBwdWJsaWMgdGl0bGU6IHN0cmluZyxcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyxcbiAgICBwdWJsaWMgcGVvcGxlOiBudW1iZXIsXG4gICAgcHVibGljIHN0YXR1czogUHJvamVjdFN0YXR1c1xuICApIHsgfVxufVxuXG4iLCJpbXBvcnQgeyBQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QnO1xuXG4vLyBQcm9qZWN0IFN0YXRlIE1nbXRcblxudHlwZSBMaXN0ZW5lcjxUPiA9IChpdGVtczogVFtdKSA9PiB2b2lkO1xuXG5jbGFzcyBTdGF0ZTxUPiB7XG4gIHByb3RlY3RlZCBsaXN0ZW5lcnM6IExpc3RlbmVyPFQ+W10gPSBbXTtcblxuICBhZGRMaXN0ZW5lcihsaXN0ZW5lckZuOiBMaXN0ZW5lcjxUPikge1xuICAgIHRoaXMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXJGbik7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb2plY3RTdGF0ZSBleHRlbmRzIFN0YXRlPFByb2plY3Q+IHtcbiAgcHJpdmF0ZSBwcm9qZWN0czogUHJvamVjdFtdID0gW107XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBQcm9qZWN0U3RhdGU7XG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIC8vIHJldHVybiBhbiBpbml0aWFsIGluc3RhbmNlIHdpdGggc2luZ2xldG9uIGNvbnN0cnVjdG9yXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbiAgICBpZiAodGhpcy5pbnN0YW5jZSkge1xuICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gICAgfVxuICAgIHRoaXMuaW5zdGFuY2UgPSBuZXcgUHJvamVjdFN0YXRlKCk7XG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gIH1cblxuICBhZGRQcm9qZWN0KHRpdGxlOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcsIG51bU9mUGVvcGxlOiBudW1iZXIpIHtcbiAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QoTWF0aC5yYW5kb20oKS50b1N0cmluZygpLCB0aXRsZSwgZGVzY3JpcHRpb24sIG51bU9mUGVvcGxlLCBQcm9qZWN0U3RhdHVzLkFjdGl2ZSk7XG4gICAgdGhpcy5wcm9qZWN0cy5wdXNoKG5ld1Byb2plY3QpO1xuICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XG4gIH1cblxuICBtb3ZlUHJvamVjdChwcm9qZWN0SWQ6IHN0cmluZywgbmV3U3RhdHVzOiBQcm9qZWN0U3RhdHVzKSB7XG4gICAgY29uc3QgcHJvamVjdCA9IHRoaXMucHJvamVjdHMuZmluZChwcmogPT4gcHJqLmlkID09PSBwcm9qZWN0SWQpO1xuICAgIGlmIChwcm9qZWN0ICYmIHByb2plY3Quc3RhdHVzICE9PSBuZXdTdGF0dXMpIHtcbiAgICAgIHByb2plY3Quc3RhdHVzID0gbmV3U3RhdHVzO1xuICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUxpc3RlbmVycygpIHtcbiAgICBmb3IgKGNvbnN0IGxpc3RlbmVyRm4gb2YgdGhpcy5saXN0ZW5lcnMpIHtcbiAgICAgIGxpc3RlbmVyRm4odGhpcy5wcm9qZWN0cy5zbGljZSgpKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gY3JlYXRlIGdsb2JhbCBpbnN0YW5jZSBvZiBQcm9qZWN0U3RhdGVcbmV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTtcbiIsIi8vIGF1dG9iaW5kIGRlY29yYXRvclxuZXhwb3J0IGZ1bmN0aW9uIGF1dG9iaW5kKF86IGFueSwgXzI6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSB7XG4gIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcbiAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICBnZXQoKSB7XG4gICAgICBjb25zdCBib3VuZEZuID0gb3JpZ2luYWxNZXRob2QuYmluZCh0aGlzKTtcbiAgICAgIHJldHVybiBib3VuZEZuO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGFkakRlc2NyaXB0b3I7XG59XG4iLCJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuL2Jhc2UtY29tcG9uZW50JztcbmltcG9ydCB7IFZhbGlkYXRhYmxlLCB2YWxpZGF0ZSB9IGZyb20gJy4uL3V0aWwvdmFsaWRhdGlvbic7XG5pbXBvcnQgeyBwcm9qZWN0U3RhdGUgfSBmcm9tICcuLi9zdGF0ZS9wcm9qZWN0LXN0YXRlJztcbmltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9hdXRvYmluZCc7XG5cbi8vIFByb2plY3RJbnB1dCBjbGFzc1xuLy8gY3JlYXRlIGNsYXNzIHRvIGFjY2VzcyBkb20gZWxlbWVudHMgaW4gYW4gT09QIHdheVxuZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEZvcm1FbGVtZW50PiB7XG4gIHRpdGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICBkZXNjcmlwdGlvbklucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgcGVvcGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCdwcm9qZWN0LWlucHV0JywgJ2FwcCcsIHRydWUsICd1c2VyLWlucHV0JylcbiAgICAvLyBsZXQncyBnZXQgYWNjZXNzIHRvIHRoZSBkaWZmZXJlbnQgaW5wdXRzIG9mIHRoZSBmb3JtIGFuZCBzdG9yZSB0aGVtIGFzIHByb3BzIG9mIHRoaXMgY2xhc3NcbiAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0aXRsZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjZGVzY3JpcHRpb24nKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwZW9wbGUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIC8vIGNhbGwgbGlzdGVuZXJcbiAgICB0aGlzLmNvbmZpZ3VyZSgpO1xuICB9XG5cbiAgY29uZmlndXJlKCkge1xuICAgIC8vIHRoZSBmaXJzdCBhcmcgb2YgYmluZCBtZXRob2QgZGVjbGFyZXMgd2hhdCB0aGUgJ3RoaXMnIGtleXdvcmQgd2lsbCByZWZlciB0byBcbiAgICAvLyBpbnNpZGUgdGhlIHRvIGJlIGV4ZWN1dGVkIGZ1bmN0aW9uLCBtZXRob2Qgc3VibWl0SGFuZGxlciBpbiBvdXIgY2FzZVxuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCB0aGlzLnN1Ym1pdEhhbmRsZXIpXG4gIH1cblxuICByZW5kZXJDb250ZW50KCkgeyB9O1xuXG4gIC8vIHZhbGlkYXRlIHVzZXIgaW5wdXQsIHdlIHVzZSBhIHR1cGxlIHRvIHZhbGlkYXRlIHRoZSAzIGZvcm0gZWxlbWVudCB2YWx1ZXNcbiAgcHJpdmF0ZSBnYXRoZXJVc2VySW5wdXQoKTogW3N0cmluZywgc3RyaW5nLCBudW1iZXJdIHwgdm9pZCB7XG4gICAgY29uc3QgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZTtcbiAgICBjb25zdCBlbnRlcmVkRGVzY3JpcHRpb24gPSB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlO1xuICAgIGNvbnN0IGVudGVyZWRQZW9wbGUgPSB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZTtcblxuICAgIGNvbnN0IHRpdGxlVmFsaWRhdGFibGU6IFZhbGlkYXRhYmxlID0ge1xuICAgICAgdmFsdWU6IGVudGVyZWRUaXRsZSxcbiAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgfTtcbiAgICBjb25zdCBkZXNjcmlwdGlvblZhbGlkYXRhYmxlOiBWYWxpZGF0YWJsZSA9IHtcbiAgICAgIHZhbHVlOiBlbnRlcmVkRGVzY3JpcHRpb24sXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgIG1pbkxlbmd0aDogNVxuICAgIH07XG4gICAgY29uc3QgcGVvcGxlVmFsaWRhdGFibGU6IFZhbGlkYXRhYmxlID0ge1xuICAgICAgdmFsdWU6ICtlbnRlcmVkUGVvcGxlLFxuICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICBtaW46IDEsXG4gICAgICBtYXg6IDVcbiAgICB9O1xuICAgIC8vIHZhbGlkYXRlIGVhY2ggaW5wdXQgc2VwZXJhdGVseSwgZmFpbCBpZiBhbnkgPSBmYWxzZVxuICAgIGlmIChcbiAgICAgICF2YWxpZGF0ZSh0aXRsZVZhbGlkYXRhYmxlKSB8fFxuICAgICAgIXZhbGlkYXRlKGRlc2NyaXB0aW9uVmFsaWRhdGFibGUpIHx8XG4gICAgICAhdmFsaWRhdGUocGVvcGxlVmFsaWRhdGFibGUpXG4gICAgKSB7XG4gICAgICBhbGVydCgnSW52YWxpZCBpbnB1dCcpO1xuICAgICAgLy8gc2hvdWxkIHRocm93IGVycm9yIGhlcmUgYW5kIGltcGxlbWVudCBlcnJvciBoYW5kbGluZ1xuICAgICAgLy8gdG8gYmUgc2ltcGxlIHdlIHdpbGwganVzdCByZXR1cm4gdG8gY29udGludWUsXG4gICAgICAvLyBmb3IgdGhhdCB0byB3b3JrIHdlIG5lZWQgdG8gYWRkICd8IHZvaWQnIGFib3ZlIGFzIHJldHVybiB0eXBlIGFzIHdlbGwgYXMgdHVwbGVcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFtlbnRlcmVkVGl0bGUsIGVudGVyZWREZXNjcmlwdGlvbiwgK2VudGVyZWRQZW9wbGVdXG4gICAgfVxuICB9XG5cbiAgLy8gY2xlYXIgaW5wdXRzXG4gIHByaXZhdGUgY2xlYXJJbnB1dHMoKSB7XG4gICAgdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSA9ICcnO1xuICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcbiAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZSA9ICcnO1xuICB9XG5cbiAgLy8gYmluZCBsaXN0ZW5lciB0byBldmVudFxuICBAYXV0b2JpbmRcbiAgcHJpdmF0ZSBzdWJtaXRIYW5kbGVyKGV2ZW50OiBFdmVudCkge1xuICAgIC8vIGFjY2VzcyBhbmQgdmFsaWRhdGUgaW5wdXRzXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWUpO1xuICAgIGNvbnN0IHVzZXJJbnB1dCA9IHRoaXMuZ2F0aGVyVXNlcklucHV0KCk7XG4gICAgLy8gY2hlY2sgaXQgdXNlcklucHV0IGlzIHR1cGxlXG4gICAgLy8gdHVwbGUgZG9lc24ndCBleGlzdCBhcyBhIHR5cGUgaW4gSlMsIGl0J3Mgc2ltcGx5IGFuZCBBcnJheVxuICAgIC8vIHNvIHdlIGNhbiB2ZXJpZnkgaWYgdGhlIHVzZXJJbnB1dCBpcyBhbiBBcnJheVxuICAgIGlmIChBcnJheS5pc0FycmF5KHVzZXJJbnB1dCkpIHtcbiAgICAgIC8vIGRlc3RydWN0dXJlIHVzZXJJbnB1dFxuICAgICAgY29uc3QgW3RpdGxlLCBkZXNjLCBwZW9wbGVdID0gdXNlcklucHV0O1xuICAgICAgY29uc29sZS5sb2codGl0bGUsIGRlc2MsIHBlb3BsZSk7XG4gICAgICBwcm9qZWN0U3RhdGUuYWRkUHJvamVjdCh0aXRsZSwgZGVzYywgcGVvcGxlKTtcbiAgICAgIHRoaXMuY2xlYXJJbnB1dHMoKTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7IERyYWdnYWJsZSB9IGZyb20gJy4uL21vZGVscy9kcmFnLWRyb3AnO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi9iYXNlLWNvbXBvbmVudCc7XG5pbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QnO1xuaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tICcuLi9kZWNvcmF0b3JzL2F1dG9iaW5kJztcblxuLy8gUHJvamVjdCBJdGVtIENsYXNzXG5leHBvcnQgY2xhc3MgUHJvamVjdEl0ZW0gZXh0ZW5kcyBDb21wb25lbnQ8SFRNTFVMaXN0RWxlbWVudCwgSFRNTExJRWxlbWVudD4gaW1wbGVtZW50cyBEcmFnZ2FibGUge1xuICBwcml2YXRlIHByb2plY3Q6IFByb2plY3Q7XG5cbiAgZ2V0IHBlcnNvbnMoKSB7XG4gICAgaWYgKHRoaXMucHJvamVjdC5wZW9wbGUgPT09IDEpIHtcbiAgICAgIHJldHVybiAnMSBwZXJzb24nO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCR7dGhpcy5wcm9qZWN0LnBlb3BsZX0gcGVyc29uc2A7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IoaG9zdElkOiBzdHJpbmcsIHByb2plY3Q6IFByb2plY3QpIHtcbiAgICBzdXBlcignc2luZ2xlLXByb2plY3QnLCBob3N0SWQsIGZhbHNlLCBwcm9qZWN0LmlkKTtcbiAgICB0aGlzLnByb2plY3QgPSBwcm9qZWN0O1xuXG4gICAgdGhpcy5jb25maWd1cmUoKTtcbiAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBkcmFnU3RhcnRIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICBldmVudC5kYXRhVHJhbnNmZXIhLnNldERhdGEoJ3RleHQvcGxhaW4nLCB0aGlzLnByb2plY3QuaWQpO1xuICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJztcbiAgfTtcblxuICBkcmFnRW5kSGFuZGxlcihfOiBEcmFnRXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZygnZHJhZ2VuZCcpO1xuICB9O1xuXG5cbiAgY29uZmlndXJlKCkge1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpXG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmRIYW5kbGVyKVxuICB9O1xuXG4gIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyJykhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LnRpdGxlO1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdoMycpIS50ZXh0Q29udGVudCA9IHRoaXMucGVyc29ucyArICcgYXNzaWduZWQnO1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdwJykhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LmRlc2NyaXB0aW9uO1xuICB9O1xufVxuIiwiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi9iYXNlLWNvbXBvbmVudCc7XG5pbXBvcnQgeyBQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QnO1xuaW1wb3J0IHsgRHJhZ1RhcmdldCB9IGZyb20gJy4uL21vZGVscy9kcmFnLWRyb3AnO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSAnLi4vc3RhdGUvcHJvamVjdC1zdGF0ZSc7XG5pbXBvcnQgeyBQcm9qZWN0SXRlbSB9IGZyb20gJy4vcHJvamVjdC1pdGVtJztcbmltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9hdXRvYmluZCc7XG5cbi8vIFByb2plY3RMaXN0IGNsYXNzXG5leHBvcnQgY2xhc3MgUHJvamVjdExpc3QgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxFbGVtZW50PiBpbXBsZW1lbnRzIERyYWdUYXJnZXQge1xuICBhc3NpZ25lZFByb2plY3RzOiBQcm9qZWN0W107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0eXBlOiAnYWN0aXZlJyB8ICdmaW5pc2hlZCcpIHtcbiAgICBzdXBlcigncHJvamVjdC1saXN0JywgJ2FwcCcsIGZhbHNlLCBgJHt0eXBlfS1wcm9qZWN0c2ApO1xuICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IFtdO1xuICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgZHJhZ092ZXJIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmIChldmVudC5kYXRhVHJhbnNmZXIgJiYgZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzWzBdID09PSAndGV4dC9wbGFpbicpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSE7XG4gICAgICBsaXN0RWwuY2xhc3NMaXN0LmFkZCgnZHJvcHBhYmxlJyk7XG4gICAgfVxuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGRyb3BIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHByaklkID0gZXZlbnQuZGF0YVRyYW5zZmVyIS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG4gICAgcHJvamVjdFN0YXRlLm1vdmVQcm9qZWN0KHByaklkLCB0aGlzLnR5cGUgPT09ICdhY3RpdmUnID8gUHJvamVjdFN0YXR1cy5BY3RpdmUgOiBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkKTtcblxuICAgIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcihldmVudCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgZHJhZ0xlYXZlSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSE7XG4gICAgbGlzdEVsLmNsYXNzTGlzdC5yZW1vdmUoJ2Ryb3BwYWJsZScpO1xuICB9XG5cbiAgY29uZmlndXJlKCkge1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTtcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2xlYXZlJywgdGhpcy5kcmFnTGVhdmVIYW5kbGVyKTtcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJvcEhhbmRsZXIpO1xuXG4gICAgcHJvamVjdFN0YXRlLmFkZExpc3RlbmVyKChwcm9qZWN0czogUHJvamVjdFtdKSA9PiB7XG4gICAgICBjb25zdCByZWxldmFudFByb2plY3RzID0gcHJvamVjdHMuZmlsdGVyKHByaiA9PiB7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdhY3RpdmUnKSB7XG4gICAgICAgICAgcmV0dXJuIHByai5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuQWN0aXZlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSByZWxldmFudFByb2plY3RzO1xuICAgICAgdGhpcy5yZW5kZXJQcm9qZWN0cygpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgY29uc3QgbGlzdElkID0gYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YDtcbiAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSEuaWQgPSBsaXN0SWQ7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyJykhLnRleHRDb250ZW50ID0gdGhpcy50eXBlLnRvVXBwZXJDYXNlKCkgKyAnIFBST0pFQ1RTJztcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyUHJvamVjdHMoKSB7XG4gICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YCkhIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XG4gICAgLy8gd2Ugd2lsbCBjbGVhciB0aGUgaW5uZXJIVE1MIHNvIHRoYXQgcHJldmlvdXNseSBlbnRlcmVkIHByb2plY3RzIHdpbGwgbm90IGJlIGR1cGxpY2F0ZWRcbiAgICAvLyB3b3VsZCBiZSBiZXR0ZXIgdG8gcnVuIGEgY29tcGFyaXNvbiBjaGVja2luZyB3aGF0J3MgYmVlbiByZW5kZXJlZCB2cyBub3QsXG4gICAgLy8gdGhlbiBvbmx5IHJlcmVuZGVyIHdoYXRzIG5lY2Vzc2FyeS4gdGhpcyBjb3N0cyBwZXJmb3JtYW5jZSB0aG91Z2hcbiAgICBsaXN0RWwuaW5uZXJIVE1MID0gJyc7XG4gICAgZm9yIChjb25zdCBwcmpJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xuICAgICAgbmV3IFByb2plY3RJdGVtKHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpIS5pZCwgcHJqSXRlbSk7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBQcm9qZWN0SW5wdXQgfSBmcm9tICcuL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dCc7XG5pbXBvcnQgeyBQcm9qZWN0TGlzdCB9IGZyb20gJy4vY29tcG9uZW50cy9wcm9qZWN0LWxpc3QnO1xuXG5uZXcgUHJvamVjdElucHV0KCk7XG5uZXcgUHJvamVjdExpc3QoJ2FjdGl2ZScpO1xubmV3IFByb2plY3RMaXN0KCdmaW5pc2hlZCcpO1xuIl0sIm5hbWVzIjpbIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwidGVtcGxhdGVJZCIsImhvc3RFbGVtZW50SWQiLCJpbnNlcnRBdFN0YXJ0IiwibmV3RWxlbWVudElkIiwidGhpcyIsInRlbXBsYXRlRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJob3N0RWxlbWVudCIsImltcG9ydGVkTm9kZSIsImltcG9ydE5vZGUiLCJjb250ZW50IiwiZWxlbWVudCIsImZpcnN0RWxlbWVudENoaWxkIiwiaWQiLCJhdHRhY2giLCJpbnNlcnRBdEJlZ2lubmluZyIsImluc2VydEFkamFjZW50RWxlbWVudCIsInZhbGlkYXRlIiwidmFsaWRhdGFibGVJbnB1dCIsImlzVmFsaWQiLCJyZXF1aXJlZCIsInZhbHVlIiwidG9TdHJpbmciLCJ0cmltIiwibGVuZ3RoIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwibWluIiwibWF4IiwiUHJvamVjdFN0YXR1cyIsIlByb2plY3QiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwicGVvcGxlIiwic3RhdHVzIiwiUHJvamVjdFN0YXRlIiwibGlzdGVuZXJzIiwiYWRkTGlzdGVuZXIiLCJsaXN0ZW5lckZuIiwicHVzaCIsInN1cGVyIiwicHJvamVjdHMiLCJzdGF0aWMiLCJpbnN0YW5jZSIsImFkZFByb2plY3QiLCJudW1PZlBlb3BsZSIsIm5ld1Byb2plY3QiLCJNYXRoIiwicmFuZG9tIiwiQWN0aXZlIiwidXBkYXRlTGlzdGVuZXJzIiwibW92ZVByb2plY3QiLCJwcm9qZWN0SWQiLCJuZXdTdGF0dXMiLCJwcm9qZWN0IiwiZmluZCIsInByaiIsInNsaWNlIiwicHJvamVjdFN0YXRlIiwiZ2V0SW5zdGFuY2UiLCJhdXRvYmluZCIsIl8iLCJfMiIsImRlc2NyaXB0b3IiLCJvcmlnaW5hbE1ldGhvZCIsImNvbmZpZ3VyYWJsZSIsImdldCIsImJpbmQiLCJQcm9qZWN0SW5wdXQiLCJ0aXRsZUlucHV0RWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJkZXNjcmlwdGlvbklucHV0RWxlbWVudCIsInBlb3BsZUlucHV0RWxlbWVudCIsImNvbmZpZ3VyZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdWJtaXRIYW5kbGVyIiwicmVuZGVyQ29udGVudCIsImdhdGhlclVzZXJJbnB1dCIsImVudGVyZWRUaXRsZSIsImVudGVyZWREZXNjcmlwdGlvbiIsImVudGVyZWRQZW9wbGUiLCJkZXNjcmlwdGlvblZhbGlkYXRhYmxlIiwicGVvcGxlVmFsaWRhdGFibGUiLCJhbGVydCIsImNsZWFySW5wdXRzIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInVzZXJJbnB1dCIsIkFycmF5IiwiaXNBcnJheSIsImRlc2MiLCJjb25zb2xlIiwibG9nIiwiUHJvamVjdEl0ZW0iLCJob3N0SWQiLCJwZXJzb25zIiwiZHJhZ1N0YXJ0SGFuZGxlciIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJlZmZlY3RBbGxvd2VkIiwiZHJhZ0VuZEhhbmRsZXIiLCJ0ZXh0Q29udGVudCIsIlByb2plY3RMaXN0IiwidHlwZSIsImFzc2lnbmVkUHJvamVjdHMiLCJkcmFnT3ZlckhhbmRsZXIiLCJ0eXBlcyIsImNsYXNzTGlzdCIsImFkZCIsImRyb3BIYW5kbGVyIiwicHJqSWQiLCJnZXREYXRhIiwiRmluaXNoZWQiLCJkcmFnTGVhdmVIYW5kbGVyIiwicmVtb3ZlIiwicmVsZXZhbnRQcm9qZWN0cyIsImZpbHRlciIsInJlbmRlclByb2plY3RzIiwibGlzdElkIiwidG9VcHBlckNhc2UiLCJpbm5lckhUTUwiLCJwcmpJdGVtIl0sInNvdXJjZVJvb3QiOiIifQ==